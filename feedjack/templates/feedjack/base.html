<!DOCTYPE html>
<html>
{% load i18n %}
{% load urlparams %}
<!--
  Feedjack LostWoods theme
  Simple and green (where's the brown? -brown doesn't count)

  Copyright Diego Escalante Urrelo <diegoe@gnome.org>
 -->
<head>
	<meta name="description" content="Feedjack" />
	<meta name="generator" content="Feedjack">
	<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8">
    <meta name="referrer" content="never">
    {% comment %}
        TODO: use self hosted jquery with a django-jquery package
    {% endcomment %}
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/feedjack/plain/style.css" /> <!-- TODO: use { % static % } -->
        <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="{{ site.url }}/feed/rss/" />
        {% block extrastyle %}{% endblock %}
        {% block extrahead %}{% endblock %}
        <title>{{ site.title }}</title>
    <style>
        .mark-post td {
            border: thin solid black;
        }
        .mark-post td.active.U { background-color: pink }
        .mark-post td.active.R { background-color: lightgreen }
        .mark-post td.active.L { background-color: lightyellow }
        .mark-post td.active.F { background-color: yellow }
        .mark-post td.active.I { background-color: red }
        .mark-post td a {
            display: block;
            padding: 1ex;
        }
        .mark-post td:hover {
            background-color: lightgrey;
        }
    </style>
    <script>
        function mark_post(post_id, mark) {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function() {
                if(this.readyState == 4) {
                    if(this.status != 200) {
                        alert("Error marking post.");
                    }
                }
            }
            request.open("GET", "/mark-post/"+post_id+"/"+mark+"/", true);
            request.send();
            document.getElementById("mark-post-"+post_id+"-U").classList.remove("active");
            document.getElementById("mark-post-"+post_id+"-R").classList.remove("active");
            document.getElementById("mark-post-"+post_id+"-L").classList.remove("active");
            document.getElementById("mark-post-"+post_id+"-F").classList.remove("active");
            document.getElementById("mark-post-"+post_id+"-I").classList.remove("active");

            document.getElementById("mark-post-"+post_id+"-"+mark).classList.add("active");
        }
        function loadPage(url) {
            jQuery("#content").load(url + " #content > *", function(){
                $("html, body").animate({scrollTop: 0}, "slow");
                window.history.pushState(false, "", url);
            });
        }
    </script>

</head>

<body>
<div id="head">
    <div id="logo">
        <h1><a href="{{ site.url }}/">{{ site.name }}</a></h1>
    <div style="float: right">
	{% trans "Last update" %}: <b>{{ last_checked|date:"l, d. F Y, G:i:s" }}</b>
    <br />
	{% trans "Last modified" %}: <b>{{ last_modified|date:"l, d. F Y, G:i:s" }}</b>
    </div>
    <a href="{% url 'auth_login' %}?next=/%3F{% urlparams_quoted url_parameters "" %}">Login</a>
    </div>
</div>

<div id="content">
{% block content %}
{% endblock content %}
</div>


<div id="footer">
<div class="post-title">{% trans "People" %}</div>
<div class="post-content">

{% for group in groups %}
    <div class="groupname"><a href="?group={{group.id}}{% urlparams url_parameters "group" %}">{{ group.name }}</a></div>
    <div class="group">
    {% for subscriber in group.subscriber_set.all %}
    <span>
        <a class="nombre" href="?subscriber={{ subscriber.id }}{% urlparams url_parameters "subscriber&group" %}" title="{{ subscriber.feed.title }}">
            {{ subscriber.name }}
        </a>
        (<a href="{{ subscriber.feed.link }}">{% trans "website" %}</a>,
        <a href="{{ subscriber.feed.feed_url }}" {% if subscriber.feed.last_modified %}title="{% blocktrans with subscriber.feed.last_modified as last_modified %} feed (last modified: {{ last_modified }}){% endblocktrans %}"{% else %}title="{% trans "feed" %}"{% endif %}>
            {% trans "feed" %}
        </a>)
    </span>
    {% endfor %}
    </div>
{% endfor %}

<div class="groupname">Ungrouped</div>
<div class="group">
{% for subscriber in ungrouped %}
    <span>
        <a class="nombre" href="?subscriber={{ subscriber.id }}{% urlparams url_parameters "subscriber&group" %}" title="{{ subscriber.feed.title }}">
            {{ subscriber.name }}
        </a>
        (<a href="{{ subscriber.feed.link }}">{% trans "website" %}</a>,
        <a href="{{ subscriber.feed.feed_url }}" {% if subscriber.feed.last_modified %}title="{% blocktrans with subscriber.feed.last_modified as last_modified %} feed (last modified: {{ last_modified }}){% endblocktrans %}"{% else %}title="{% trans "feed" %}"{% endif %}>
            {% trans "feed" %}
        </a>)
    </span>
{% endfor %}
</div>
</div>

{% comment %}
<!-- TODO: as fancy date parsing is removed, the date parameters for the urls need to be calculated in views.py -->
<div class="groupname">new posts</div>
<div class="group">
    <a href="?since=yesterday&asc=0{% urlparams url_parameters "since&asc" %}">since yesterday</a>
    <a href="?since=yesterday&asc=1{% urlparams url_parameters "since&asc" %}">(older posts first)</a>
    &nbsp;&nbsp;
    <a href="?since=week&asc=0{% urlparams url_parameters "since&asc" %}">since last week</a>
    <a href="?since=week&asc=1{% urlparams url_parameters "since&asc" %}">(older posts first)</a>
    &nbsp;&nbsp;
    <a href="?since=10_days&asc=0{% urlparams url_parameters "since&asc" %}">since 10 days</a>
    <a href="?since=10_days&asc=1{% urlparams url_parameters "since&asc" %}">(older posts first)</a>
    &nbsp;&nbsp;
    <a href="?since=30_days&asc=0{% urlparams url_parameters "since&asc" %}">since 30 days</a>
    <a href="?since=30_days&asc=1{% urlparams url_parameters "since&asc" %}">(older posts first)</a>
    &nbsp;&nbsp;
    <a href="?since={% now "Y-m-d H:i" %}&asc=0{% urlparams url_parameters "since&asc" %}" title="open this now and refresh it later to see which posts are new">since NOW</a>
    <a href="?since={% now "Y-m-d H:i" %}&asc=1{% urlparams url_parameters "since&asc" %}" %}/">(older posts first)</a>
</div>
{% endcomment %}
{% if request.user.is_authenticated %}
    <div class="groupname">Admin</div>
    <div class="group">
    <a href="/admin/feedjack/subscriber/add/">add Subscriber</a>
    </div>
{%endif%}

</div>
</div>
</div>
</body>

</html>
